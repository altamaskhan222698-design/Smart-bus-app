<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Bus Final</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #121212; color: white; padding: 20px; }
        #reader { width: 300px; margin: 0 auto; border-radius: 15px; border: 2px solid #00ffcc; }
        .display { background: #222; border: 2px solid #444; padding: 20px; margin-top: 20px; border-radius: 10px; }
        .bus-no { font-size: 30px; color: #ffab00; font-weight: bold; }
        .btn { background: #008CBA; color: white; padding: 10px 20px; border: none; border-radius: 5px; margin: 5px; cursor: pointer; }
        #status-box { color: #00ffcc; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <h1>üöè SMART BUS STATION</h1>
    
    <div id="reader"></div>
    
    <div id="status-box">System Ready</div>

    <div class="display" id="mainDisplay">
        <div id="busNumber" class="bus-no">WAITING...</div>
        <div id="routeInfo" style="margin-top:10px;">Scan a Bus QR Code</div>
    </div>

    <button class="btn" onclick="startScanner()">1. SCANNER ON</button>
    <button class="btn" style="background:#4caf50;" onclick="testVoice()">2. TEST VOICE (Awaaz Check)</button>

    <script>
        const busData = {
            "BUS_101": {
                hindi: "‡§Ø‡§æ‡§§‡•ç‡§∞‡•Ä‡§ó‡§£ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç. ‡§¨‡§∏ ‡§®‡§Ç‡§¨‡§∞ 101, ‡§Æ‡•Å‡§Ç‡§¨‡§à ‡§∏‡•á ‡§¶‡§ø‡§≤‡•ç‡§≤‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü ‡§ó‡§Ø‡•Ä ‡§π‡•à.",
                english: "Attention please. Bus number 101 for Delhi has arrived.",
                route: "Mumbai to Delhi"
            },
            "BUS_102": {
                hindi: "‡§Ø‡§æ‡§§‡•ç‡§∞‡•Ä‡§ó‡§£ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç. ‡§¨‡§∏ ‡§®‡§Ç‡§¨‡§∞ 102, ‡§∏‡•ç‡§ï‡•Ç‡§≤ ‡§∏‡•á ‡§ò‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ü ‡§ó‡§Ø‡•Ä ‡§π‡•à.",
                english: "Attention please. Bus number 102 for Home has arrived.",
                route: "School to Home"
            }
        };

        let isSpeaking = false;
        let html5QrcodeScanner;

        function onScanSuccess(decodedText) {
            // Agar pehle se bol raha hai to ignore karein
            if (isSpeaking) return;

            // Check karein ki QR data hamari list mein hai ya nahi
            if (busData[decodedText]) {
                const data = busData[decodedText];
                
                // Screen update karein
                document.getElementById('busNumber').innerText = "BUS " + decodedText.split('_')[1];
                document.getElementById('routeInfo').innerText = data.route;
                document.getElementById('status-box').innerText = "‚úÖ Bus Found!";

                // Announcement karein
                speakDual(data.hindi, data.english);
            } else {
                // Agar galat QR hai
                document.getElementById('status-box').innerText = "‚ùå Unknown: " + decodedText;
            }
        }

        function startScanner() {
            html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);
            document.getElementById('status-box').innerText = "Scanning Start...";
        }

        function speakDual(hi, en) {
            isSpeaking = true;
            window.speechSynthesis.cancel(); // Purani awaaz band karein

            let msgHi = new SpeechSynthesisUtterance(hi);
            msgHi.lang = 'hi-IN';
            
            let msgEn = new SpeechSynthesisUtterance(en);
            msgEn.lang = 'en-IN';

            msgHi.onend = () => { window.speechSynthesis.speak(msgEn); };
            msgEn.onend = () => { isSpeaking = false; document.getElementById('status-box').innerText = "Ready for Next"; };

            window.speechSynthesis.speak(msgHi);
        }

        function testVoice() {
            let t = new SpeechSynthesisUtterance("Awaaz aa rahi hai");
            t.lang = 'hi-IN';
            window.speechSynthesis.speak(t);
            alert("Agar awaaz aayi, to system sahi hai!");
        }
    </script>
</body>
</html>
